From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bj=C3=B6rn=20Bidar?= <bjorn.bidar@jolla.com>
Date: Mon, 30 Sep 2024 09:18:21 +0300
Subject: [PATCH] Implicitly load OpenSSL configuration

For applications to load the OpenSSL configuration they have to call
OPENSSL_config(). Many applications/libraries don't do so.
Instead we can pass -DOPENSSL_LOAD_CONF in the pkgconfig files
so the needed operation becomes implicit the next time such apps
are recompiled, see OPENSSL_config(3).
---
 exporters/pkg-config/libcrypto.pc.in | 2 +-
 exporters/pkg-config/libssl.pc.in    | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/exporters/pkg-config/libcrypto.pc.in b/exporters/pkg-config/libcrypto.pc.in
index 3d56e97418..328627d41e 100644
--- a/exporters/pkg-config/libcrypto.pc.in
+++ b/exporters/pkg-config/libcrypto.pc.in
@@ -19,7 +19,7 @@ Description: OpenSSL cryptography library
 Version: {- $OpenSSL::safe::installdata::VERSION -}
 Libs: -L${libdir} -lcrypto
 Libs.private: {- join(' ', @OpenSSL::safe::installdata::LDLIBS) -}
-Cflags:{- $OUT = ' -I${includedir}';
+Cflags:{- $OUT = ' -DOPENSSL_LOAD_CONF -I${includedir}';
           if (scalar @OpenSSL::safe::installdata::INCLUDEDIR_REL_PREFIX > 1) {
               $OUT = '';
               $OUT .= ' -I${prefix}/' . $_ . ' '
diff --git a/exporters/pkg-config/libssl.pc.in b/exporters/pkg-config/libssl.pc.in
index 162db65c99..d92d79d913 100644
--- a/exporters/pkg-config/libssl.pc.in
+++ b/exporters/pkg-config/libssl.pc.in
@@ -17,7 +17,7 @@ Description: Secure Sockets Layer and cryptography libraries
 Version: {- $OpenSSL::safe::installdata::VERSION -}
 Requires.private: libcrypto
 Libs: -L${libdir} -lssl
-Cflags:{- $OUT = ' -I${includedir}';
+Cflags:{- $OUT = ' -DOPENSSL_LOAD_CONF -I${includedir}';
           if (scalar @OpenSSL::safe::installdata::INCLUDEDIR_REL_PREFIX > 1) {
               $OUT = '';
               $OUT .= ' -I${prefix}/' . $_ . ' '
